# 🏆 2024 인하 인공지능 챌린지

1. 주제 : 한국 경제 기사 분석 및 질의응답
    
    ★ 참가자 전원에게 주제 및 예제코드 관련 기초 교육 자료 제공
    
2. 대 상 : 인하대 학부 및 대학원 재학생 팀 (팀당 2~5인)
3. 대회 기간 : '24. 7. 2(화) 오후 1시 ~ 8. 14(수) 오후 6시
4. 주관: 인공지능융합연구센터, BK 산업융합형 차세대 인공지능 혁신인재 교육연구단
5. 후원: 포티투마루(42MARU)
6. 운영: 데이콘

# 대회 안내
- [인하대 인공지능융합연구센터](https://aix.inha.ac.kr/?page_id=1282&vid=81)
- [Dacon](https://dacon.io/competitions/official/236291/overview/description)

# 대회 규칙

- 평가 산식 : F1 Score
- 평가 방식: 정량 평가(100%)
- 단일 GPU VRAM(48GB)에서 모델이 작동 가능해야함
- 이 외의 규칙 [대회 공식 홈페이지](https://dacon.io/competitions/official/236291/overview/rules) 참고

# 대회 결과

- **전체 2등** (학부생 트랙 2등)
- **최종 점수:** `0.90252` [데이콘 리더보드](https://dacon.io/competitions/official/236291/leaderboard)
- **대회 결과 공지:** [대회 결과 공지](https://aix.inha.ac.kr/?page_id=3841&vid=30)
- **기사 링크:** [대학저널 기사](https://dhnews.co.kr/news/view/1065575539326139)

# Dataset Info.
※ 데이터셋 파일은 대회 규정상 공개할 수 없습니다.
- **train.csv**  
    id : 샘플 고유 ID  
    context : 금융 및 경제 뉴스 기사 관련 정보  
    question : context 정보 기반 질문  
    answer : 질문에 대한 정답 (Target)  
    33716개 샘플

<div align="center">
    
| id           | context                         | question                          | answer       |
|-------------|--------------------------------|----------------------------------|-------------|
| TRAIN_00000 | 르노그룹이 지분 약 80%를...    | 실적 부진으로 인해 르노그...   | 르노삼성자동차 |
| TRAIN_00001 | 르노그룹이 지분 약 80%를...    | 실적 부진으로 인해 르노그...   | 르노삼성자동차 |
| TRAIN_00002 | 대한항공과 아시아나항공...    | 사원들에게 신년사를 이메일... | 조원태       |
| TRAIN_00003 | 대한항공과 아시아나항공...    | 누가 사원들에게 이메일을...  | 조원태       |
| TRAIN_00004 | 삼성전자가 OCP(오픈 컴퓨...   | PM9A3 E1.s의 연속쓰기 속도는? | 3000MB/s    |

</div>

<p align="center"><b>&lt;train.csv 예시&gt;</b></p><br>
    
- **test.csv**  
    id : 샘플 고유 ID  
    context : 금융 및 경제 뉴스 기사 관련 정보  
    question : context 정보 기반 질문  
    1507개 샘플

<div align="center">

| id        | context                    | question                           |
|----------|---------------------------|----------------------------------|
| TEST_0000 | 신종 코로나바이러스 감염... | 어떤 기관이 지역 중소기업...   |
| TEST_0001 | 신종 코로나바이러스 감염... | 제주 경제통상진흥원이 어떤...  |
| TEST_0002 | 신종 코로나바이러스 감염... | 상해대표처는 어느 시점에...   |
| TEST_0003 | 신종 코로나바이러스 감염... | 동경통상대표부는 어느 지...   |
| TEST_0004 | 신종 코로나바이러스 감염... | 제주경제통상진흥원이 지...   |

</div>

<p align="center"><b>&lt;test.csv 예시&gt;</b></p>


# 코드 실행 방법

- 실행 환경: colab A100

- 모델 훈련 코드
    
    `gemma2_finetuning.ipynb` rtzr/ko-gemma-2-9b-it 모델 파인튜닝 코드
    
    `eeve_finetuning.ipynb` yanolja/EEVE-Korean-Instruct-10.8B-v1.0 모델 파인튜닝 코드
    
    `nous_finetuning.ipynb` NousResearch/Nous-Hermes-2-SOLAR-10.7B 모델 파인튜닝 코드
    
- 추론 코드
    
    `Inference.ipynb` 
    
    파인튜닝한 세 개의 모델을 이용해 답을 추론한 이후
    
    앙상블 기법으로 최종 답을 추론하고 제출용 csv파일을 생성하는 코드
    
- 실행 순서
    1. 세 개의 모델 훈련 코드를 각각 실행해 각 모델을 훈련시키고 어뎁터를 `/content` 경로에 저장
        
        (만약 다른 경로로 저장했다면 추론 코드에서 어뎁터 경로를 수정)
        
    2. 추론 코드를 처음부터 ‘3. Gemma 모델 추론’까지 실행
    3. GPU memory 사용량이 1GB 미만으로 떨어지는지 확인 후 ‘4. eeve 모델 추론'실행
    4.  ‘4. eeve 모델 추론'을 전부 실행한 이후 GPU memory 사용량이 1GB 미만으로 떨어지는지 확인 후 나머지 코드 전부 실행
    
- 실행 도중 `/content` 경로에 생기는 `eeve_submission.csv`, `gemma2_submission.csv`, `nous_submission.csv` 3개의 파일은 각 모델의 추론 파일이고
최종 제출용 파일은 '/content' 경로 아래에 생기는 ensemble_final.csv 파일

# 모델 선정
- 파인튜닝 전 모델별 F1 score 비교
  
<div align="center">

| 모델명 | F1 score |
|:------:|:-------:|
| NousResearch/Nous-Hermes-2-SOLAR-10.7B | 84.3 |
| yanolja/EEVE-Korean-Instruct-10.8B-v1.0 | 83.1 |
| yanolja/KoSOLAR-10.7B-v0.2 | 79.5 |
| rtzr/ko-gemma-2-9b-it | 74.6 |
| beomi/llama-2-ko-7b | 40.1 |

</div>

- 파인튜닝 후 모델별 F1 score 비교

<div align="center">

| 모델명 | F1 score |
|:------:|:-------:|
| rtzr/ko-gemma-2-9b-it | 89.1 |
| NousResearch/Nous-Hermes-2-SOLAR-10.7B | 88.5 |
| yanolja/EEVE-Korean-Instruct-10.8B-v1.0 | 88.0 |
| yanolja/KoSOLAR-10.7B-v0.2 | 87.4 |

</div>

- 최종 선정 모델  
  `rtzr/ko-gemma-2-9b-it`  
  `NousResearch/Nous-Hermes-2-SOLAR-10.7B`  
  `yanolja/EEVE-Korean-Instruct-10.8B-v1.0`  

# 앙상블

**앙상블 사용 이유**

- 단일 모델이 갖는 성능의 한계
- 모델 별 submission 파일을 살펴보고 각 모델 별로 부족한 부분을 다른 모델이 보완해줄 가능성 확인
    
    (예: A모델이 틀리는 문제를 B모델이 맞추고 B모델이 틀리는 문제를 A모델이 맞춤) 
    
    (이는 모델의 전반적인 성능(점수)와는 별개)<br>
    

**앙상블 방식**

- 단일 모델로 추론하던 방식 그대로 3개의 모델에 대해 각각 추론을 진행
- 다수결로 많이 나온 답 선택
- 3개의 모델을 사용할 때 나올 수 있는 경우는 3:0:0 2:1:0 1:1:1 세가지
1:1:1일 때(98개의 경우)는 세 답에 대해 F1 score로 서로 비교를 진행 후 F1 score의 합이 가장 높은 답 선택<br>

**앙상블 예시**
<div align="center">

| id        | 모델A                                  | 모델B                                  | 모델C                                                       | A vs B       | B vs C       | A vs C       | 최종 정답                                  |
|:----------:|:--------------------------------------:|:--------------------------------------:|:------------------------------------------------------------:|:-------------:|:-------------:|:-------------:|:----------------------------------------:|
| TEST_0001 | 중국과 일본                          | 중국과 일본                          | 중국과 일본                                                 | 1           | 1           | 1           | 중국과 일본                              |
| TEST_0008 | 25명                                 | 25명                                 | 1710명                                                     | 1           | 0.25        | 0.25        | 25명                                    |
| TEST_0020 | 다섯 차례                            | 14일                                 | 14일, 다섯 차례                                             | 0           | 0.6         | 0.7272727273 | 14일, 다섯 차례                         |
| TEST_0099 | 공소시효                              | 선거사범의 공소시효                   | 선거 수사의 연속성                                           | 0.6153846154 | 0.4705882353 | 0           | 선거사범의 공소시효                     |
| TEST_0156 | 미국 경제 침체도 그 책임을 중국에 전가하게 될 것 | 코로나19로 인한 미국 경제 침체         | 노골적인 보호무역주의와 양자주의, 중국에 대한 제재와 미·중 무역갈등은 더욱 심해질 것 | 0.3529411765 | 0.1960784314 | 0.2105263158 | 미국 경제 침체도 그 책임을 중국에 전가하게 될 것 |

</div><br>

**F1 score로 각각의 정답을 비교하는 효과**

- F1 score는 문자 단위로 매기므로 공통된 문자가 있다면 비교하는 두 답안이 완전히 같지 않더라도 어느정도의 점수를 획득할 수 있음
- 역으로 생각하면 F1 score가 낮은 답안은 나머지 답안과 공통점이 적은 답안
- 따라서 F1 score로 최종 답안을 결정하면 세 답안 중 극단적인 답안을 피하고 공통점이 가장 큰 ‘적당한’ 답안 선택 가능
- 예를 들어 99번 문제의 경우 answer1과는 ‘공소시효’라는 공통점이 있고 answer3와는 ‘선거’라는 공통점이 있는 ‘선거사범의 공소시효’라는 적당한 답안이 선택됨  
